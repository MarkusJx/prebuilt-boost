name: Build Boost

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Boost version to build'
        required: true

jobs:
  build:
    strategy:
      matrix:
        os: ['ubuntu-latest', 'windows-latest', 'macOs-latest']

    runs-on: ${{matrix.os}}
    steps:
      - name: git clone
        run: git clone https://github.com/boostorg/boost
      - name: git checkout
        run: git checkout tags/boost-${{github.event.inputs.version}}
        working-directory: boost
      - name: git submodule init
        run: git submodule update --init --recursive
        working-directory: boost
      - name: Bootstrap windows
        if: matrix.os == 'windows-latest'
        run: bootstrap.bat
        working-directory: boost
      - name: Bootstrap unix
        if: matrix.os != 'windows-latest'
        run: ./bootstrap.sh
        working-directory: boost
      - name: B2 windows
        if: matrix.os == 'windows-latest'
        run: b2.exe -j2
        working-directory: boost
      - name: B2 unix
        if: matrix.os != 'windows-latest'
        run: ./b2 -j2
        working-directory: boost
      - name: delete .git
        run: rm -rf .git
        working-directory: boost
      - name: compress
        run: tar -czf boost-${{github.event.inputs.version}}-${{matrix.os}}.tar.gz boost
      - uses: ncipollo/release-action@v1
        with:
          draft: true
          tag: ${{github.event.inputs.version}}
          artifacts: "boost-*.tar.gz"
          token: ${{ secrets.GITHUB_TOKEN }}
